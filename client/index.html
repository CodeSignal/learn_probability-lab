<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CodeSignal Probability Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts (Work Sans) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Design System Foundations -->
  <link rel="stylesheet" href="./design-system/colors/colors.css">
  <link rel="stylesheet" href="./design-system/spacing/spacing.css">
  <link rel="stylesheet" href="./design-system/typography/typography.css">

  <!-- Design System Components -->
  <link rel="stylesheet" href="./design-system/components/button/button.css">
  <link rel="stylesheet" href="./design-system/components/boxes/boxes.css">
  <link rel="stylesheet" href="./design-system/components/input/input.css">
  <link rel="stylesheet" href="./design-system/components/numeric-slider/numeric-slider.css">
  <link rel="stylesheet" href="./design-system/components/dropdown/dropdown.css">
  <link rel="stylesheet" href="./design-system/components/tags/tags.css">
  <link rel="stylesheet" href="./design-system/components/modal/modal.css">

  <link rel="stylesheet" href="./app.css" />
</head>
<body class="bespoke">
  <!-- Navigation Header -->
  <header class="header">
    <h1 class="heading-small">CodeSignal Probability Lab</h1>
    <div class="spacer"></div>
    <div id="status" class="status heading-small">Ready</div>
    <button id="btn-help" class="button button-text">Help</button>
  </header>

  <!-- Main Application Content -->
  <main class="main-layout" id="probability-lab">
    <aside class="sidebar">
      <section class="box card card-emphasized">
        <h2>Experiment Setup</h2>
        <div id="pl-setup-device" class="pl-setup-device"></div>
        <div id="pl-setup-sample-space" class="pl-setup-sample-space"></div>
      </section>

      <section class="box card card-emphasized">
        <h2>Experiment Settings</h2>
        <div id="pl-single-config">
          <div id="pl-spinner-options" hidden>
            <label>
              Spinner sectors
              <select id="pl-spinner-sectors" class="input">
                <option value="4">4</option>
                <option value="6">6</option>
                <option value="8" selected>8</option>
              </select>
            </label>
          </div>

          <div id="pl-bias-options"></div>

          <label>
            Seed
            <input id="pl-seed" class="input" type="number" placeholder="42" />
          </label>
        </div>

        <div id="pl-two-config" hidden>
          <div class="pl-two-config-grid">
            <div class="pl-two-config-column">
              <h3>Event A</h3>
              <div id="pl-bias-options-a"></div>
            </div>

            <div class="pl-two-config-column">
              <h3>Event B</h3>
              <div id="pl-bias-options-b"></div>
            </div>
          </div>

          <label>
            Relationship
            <select id="pl-relationship" class="input">
              <option value="independent">Independent</option>
              <option value="copy">B = A (linked)</option>
              <option value="complement">Coin complement</option>
            </select>
          </label>
        </div>
      </section>

      <section class="box card card-emphasized" id="pl-event-card">
        <h2>Event E</h2>
        <p class="pl-helper-text">Select which outcomes count as success for your event.</p>
        <div id="pl-event-outcomes"></div>
        <div class="pl-metrics">
          <div class="pl-metric">
            <div class="pl-metric-label">Estimated P(E)</div>
            <div id="pl-event-est" class="pl-metric-value">—</div>
          </div>
          <div class="pl-metric">
            <div class="pl-metric-label">Theoretical P(E)</div>
            <div id="pl-event-theory" class="pl-metric-value">—</div>
          </div>
        </div>
      </section>
    </aside>

    <div class="content-area">
      <div class="pl-content">
        <!-- Trials section: always visible, standalone -->
        <section class="box card card-emphasized card-spacious pl-run-card">
          <h2>Run Trials</h2>
          <div class="pl-run-grid">
            <!-- Left column: Controls -->
            <div class="pl-trial-controls">
              <div class="pl-control-row">
                <div class="pl-step-size-group">
                  <span class="pl-control-label">Trials per step:</span>
                  <div class="pl-button-group" role="group" aria-label="Manual trials run per step">
                    <button class="pl-button-group-item active" data-value="1" type="button">1</button>
                    <button class="pl-button-group-item" data-value="10" type="button">10</button>
                    <button class="pl-button-group-item" data-value="100" type="button">50</button>
                    <button class="pl-button-group-item" data-value="1000" type="button">100</button>
                  </div>
                  <input id="pl-step-size" type="hidden" value="1" />
                </div>
                <div class="pl-action-buttons">
                  <button id="pl-step" class="button button-primary" type="button">Run Trials</button>
                </div>
              </div>

              <hr />

              <div class="pl-control-row">
                <div class="pl-speed-group">
                  <span class="pl-control-label">Speed (iterations/sec):</span>
                  <div id="pl-auto-speed-container"></div>
                </div>
              </div>

              <div class="pl-control-row pl-control-row-auto">
                <button id="pl-auto" class="button button-secondary" type="button">Automatic Run</button>
                <button id="pl-reset" class="button button-secondary" type="button">Reset Trials</button>
              </div>
            </div>

            <!-- Right column: Device + Metrics -->
            <div class="pl-run-right">
              <!-- Device visualization -->
              <div class="pl-device-section">
                <div id="pl-device-view" class="pl-device" aria-label="Trial device visualization"></div>
              </div>

              <!-- Metrics -->
              <div class="pl-trial-metrics">
                <div class="box pl-trial-metric">
                  <div class="pl-metric-label">Trials</div>
                  <div id="pl-trials" class="pl-metric-value">0</div>
                </div>
                <div class="box pl-trial-metric">
                  <div class="pl-metric-label">Last outcome</div>
                  <div id="pl-last" class="pl-metric-value">—</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Single-event mode sections -->
        <div id="pl-single-view" class="pl-content-grid">
          <section class="box card" id="pl-bar-chart-section">
            <div class="pl-chart-header">
              <h2>Relative Frequency</h2>
              <p class="pl-chart-subtitle">Bars show observed frequencies. Horizontal lines show theoretical probabilities.</p>
            </div>
            <canvas id="pl-bar-chart" class="pl-canvas" aria-label="Bar chart of relative frequencies"></canvas>
            <div class="pl-chart-legend">
              <div class="pl-legend-item">
                <div class="pl-legend-indicator bar"></div>
                <span>Observed frequency</span>
              </div>
              <div class="pl-legend-item">
                <div class="pl-legend-indicator line"></div>
                <span>Theoretical probability</span>
              </div>
            </div>
          </section>

          <section class="box card" id="pl-convergence-card">
            <div class="pl-chart-header">
              <h2>Convergence</h2>
              <p class="pl-chart-subtitle">Shows how estimated P(E) converges to theoretical probability over trials. Dashed line is the target.</p>
            </div>
            <canvas id="pl-line-chart" class="pl-canvas" aria-label="Line chart of estimated probability over trials"></canvas>
            <div class="pl-chart-legend">
              <div class="pl-legend-item">
                <div class="pl-legend-indicator bar"></div>
                <span>Estimated P(E)</span>
              </div>
              <div class="pl-legend-item">
                <div class="pl-legend-indicator dashed"></div>
                <span>Theoretical P(E)</span>
              </div>
            </div>
          </section>

          <section class="box card" id="pl-frequency-card">
            <div class="pl-chart-header">
              <h2>Frequency Table</h2>
              <p class="pl-chart-subtitle">Δ shows difference between observed and theoretical. Selected rows count toward Event E.</p>
            </div>
            <div class="pl-table-wrap">
              <table id="pl-frequency-table" class="pl-table"></table>
            </div>
          </section>
        </div>

        <!-- Two-event mode sections -->
        <div id="pl-two-view" hidden>
          <div class="pl-content-grid">
            <section class="box card" id="pl-joint-distribution-card">
              <h2>Joint Distribution</h2>
              <canvas id="pl-heatmap" class="pl-canvas" aria-label="Heatmap of joint relative frequencies"></canvas>
              <div id="pl-cell-summary" class="pl-cell-summary" aria-live="polite"></div>
            </section>

            <section class="box card" id="pl-two-way-table-card">
              <h2>Two-way Table</h2>
              <div class="pl-table-wrap">
                <table id="pl-twoway-table" class="pl-table"></table>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Core Scripts -->
  <script type="module" src="./app.js"></script>
</body>
</html>
