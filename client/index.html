<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CodeSignal Probability Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts (Work Sans) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Design System Foundations -->
  <link rel="stylesheet" href="./design-system/colors/colors.css">
  <link rel="stylesheet" href="./design-system/spacing/spacing.css">
  <link rel="stylesheet" href="./design-system/typography/typography.css">

  <!-- Design System Components -->
  <link rel="stylesheet" href="./design-system/components/button/button.css">
  <link rel="stylesheet" href="./design-system/components/boxes/boxes.css">
  <link rel="stylesheet" href="./design-system/components/input/input.css">
  <link rel="stylesheet" href="./design-system/components/numeric-slider/numeric-slider.css">
  <link rel="stylesheet" href="./design-system/components/dropdown/dropdown.css">
  <link rel="stylesheet" href="./design-system/components/tags/tags.css">
  <link rel="stylesheet" href="./design-system/components/modal/modal.css">

  <link rel="stylesheet" href="./app.css" />
</head>
<body class="bespoke">
  <!-- Navigation Header -->
  <header class="header">
    <h1 class="heading-small">CodeSignal Probability Lab</h1>
    <div class="spacer"></div>
    <button id="btn-help" class="button button-text">Help</button>
  </header>

  <!-- Main Application Content -->
  <main class="main-layout" id="probability-lab">
    <div class="pl-content">
      <div class="pl-top-grid">
        <section class="box card card-emphasized pl-setup-card">
          <div class="pl-top-card-header row-between">
            <h2 class="heading-xsmall">Experiment Setup</h2>
            <button id="pl-open-settings" class="button button-secondary button-small" type="button">Edit Experiment</button>
          </div>

          <div class="pl-setup-summary-grid">
            <div class="pl-setup-summary-item">
              <div class="pl-setup-summary-label body-xsmall">Device</div>
              <div id="pl-setup-device" class="pl-setup-device"></div>
            </div>

            <div class="pl-setup-summary-item">
              <div class="pl-setup-summary-label body-xsmall">Sample space Ω</div>
              <div class="pl-setup-sample-space-row">
                <div id="pl-setup-sample-space" class="pl-setup-sample-space"></div>
              </div>
            </div>
          </div>

          <div class="pl-setup-meta">
            <div class="pl-setup-tags" aria-label="Experiment settings summary">
              <span id="pl-bias-summary" class="tag secondary">Bias: —</span>
              <span id="pl-relationship-summary" class="tag secondary" hidden>Relationship: —</span>
            </div>

            <div id="pl-spinner-options" class="pl-spinner-options" hidden>
              <label class="row">
                <span class="body-small">Spinner sectors</span>
                <select id="pl-spinner-sectors" class="input">
                  <option value="4">4</option>
                  <option value="6">6</option>
                  <option value="8" selected>8</option>
                </select>
              </label>
            </div>
          </div>
        </section>

        <section class="box card card-emphasized card-spacious pl-run-card">
          <div class="pl-run-header row-between">
            <h2 class="heading-xsmall">Run Trials</h2>
            <button
              id="pl-reset"
              class="button button-tertiary button-small"
              type="button"
              title="Reset all trials for the current experiment"
            >Reset Trials</button>
          </div>

          <div class="pl-trial-controls">
            <div class="pl-run-modes" aria-label="Trial run modes">
              <section id="pl-run-mode-manual" class="pl-run-mode" aria-label="Manual stepping">
                <header class="pl-run-mode-title">
                  <h3 class="heading-xxxsmall">Manual step</h3>
                  <p class="pl-muted body-xsmall">Run a fixed number of trials once.</p>
                </header>

                <div class="pl-run-mode-controls">
                  <div class="pl-step-size-group">
                    <span class="pl-control-label body-small">Trials per step</span>
                    <div class="pl-button-group" role="group" aria-label="Manual trials run per step">
                      <button class="button button-secondary button-small active" data-value="1" type="button">1</button>
                      <button class="button button-secondary button-small" data-value="10" type="button">10</button>
                      <button class="button button-secondary button-small" data-value="50" type="button">50</button>
                      <button class="button button-secondary button-small" data-value="100" type="button">100</button>
                    </div>
                    <input id="pl-step-size" type="hidden" value="1" />
                  </div>

                  <button id="pl-step" class="button button-primary" type="button">Run 1 Trial</button>
                </div>
              </section>

              <section id="pl-run-mode-auto" class="pl-run-mode" aria-label="Automatic run">
                <header class="pl-run-mode-title">
                  <h3 class="heading-xxxsmall">Automatic run</h3>
                  <p class="pl-muted body-xsmall">Keep running trials until you stop it.</p>
                </header>

                <div class="pl-run-mode-controls">
                  <div class="pl-speed-group">
                    <span class="pl-control-label body-small">Speed (iterations/sec)</span>
                    <div id="pl-auto-speed-container"></div>
                  </div>

                  <button id="pl-auto" class="button button-primary" type="button">Start Automatic Run</button>
                </div>
              </section>
            </div>
          </div>
        </section>

        <section class="box card card-emphasized pl-monitor-card">
          <h2 class="heading-xsmall">Live Trial</h2>
          <div class="pl-monitor-grid">
            <div id="pl-device-view" class="pl-device" aria-label="Trial device visualization"></div>
            <div class="pl-monitor-metrics">
              <div class="box pl-trial-metric">
                <div class="pl-metric-label body-xsmall">Trials</div>
                <div id="pl-trials" class="pl-metric-value heading-small">0</div>
              </div>
              <div class="box pl-trial-metric">
                <div class="pl-metric-label body-xsmall">Last outcome</div>
                <div id="pl-last" class="pl-metric-value heading-small">—</div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div id="pl-settings-modal" class="pl-settings-modal" hidden>
        <p class="pl-helper-text body-xsmall">Changing settings resets trials for the current experiment.</p>

        <section class="box pl-settings-section" id="pl-settings-section-probabilities">
          <div class="pl-settings-section-header">
            <h3 class="heading-xxxsmall">Outcome probabilities</h3>
            <p class="pl-muted body-xsmall">These settings change the theoretical probabilities for each outcome in Ω.</p>
          </div>

          <div id="pl-single-config">
            <div id="pl-bias-options" class="pl-bias-options"></div>

            <hr class="pl-settings-divider" />

            <div class="pl-settings-section-header" id="pl-settings-section-event">
              <h3 class="heading-xxxsmall">Define event E</h3>
              <p class="pl-muted body-xsmall">Choose which outcomes count as success for your event.</p>
            </div>
            <div id="pl-event-outcomes"></div>
          </div>

          <div id="pl-two-config" hidden>
            <div class="pl-two-config-grid">
              <div class="pl-two-config-column">
                <h3 class="heading-xxxsmall">Event A</h3>
                <div id="pl-bias-options-a" class="pl-bias-options"></div>
              </div>

              <div class="pl-two-config-column">
                <h3 class="heading-xxxsmall">Event B</h3>
                <div id="pl-bias-options-b" class="pl-bias-options"></div>
              </div>
            </div>

            <label>
              Relationship
              <select id="pl-relationship" class="input">
                <option value="independent">Independent</option>
                <option value="dependent">Dependent</option>
              </select>
            </label>
          </div>
        </section>

        <section class="box pl-settings-section" id="pl-settings-section-randomness">
          <div class="pl-settings-section-header">
            <h3 class="heading-xxxsmall">Random seed</h3>
            <p class="pl-muted body-xsmall">Set a seed to reproduce the same results across runs.</p>
          </div>

          <label class="row">
            <input id="pl-seed" class="input" type="number" placeholder="42" />
          </label>
        </section>
      </div>

      <div id="pl-single-view" class="pl-content-grid">
        <section class="box card" id="pl-bar-chart-section">
          <div class="pl-chart-header">
            <h2 class="heading-xsmall">Relative Frequency</h2>
            <p class="pl-chart-subtitle body-xsmall">Bars show observed frequencies. Horizontal lines show theoretical probabilities.</p>
          </div>
          <canvas id="pl-bar-chart" class="pl-canvas" aria-label="Bar chart of relative frequencies"></canvas>
          <div class="pl-chart-legend">
            <div class="pl-legend-item body-xsmall">
              <div class="pl-legend-indicator bar"></div>
              <span>Observed frequency</span>
            </div>
            <div class="pl-legend-item body-xsmall">
              <div class="pl-legend-indicator dashed"></div>
              <span>Theoretical probability</span>
            </div>
          </div>
        </section>

        <section class="box card" id="pl-convergence-card">
          <div class="pl-chart-header">
            <h2 class="heading-xsmall">Convergence</h2>
            <p class="pl-chart-subtitle body-xsmall">Shows how estimated P(E) converges to theoretical probability over trials. Dashed line is the target.</p>
          </div>
          <canvas id="pl-line-chart" class="pl-canvas" aria-label="Line chart of estimated probability over trials"></canvas>
          <div class="pl-chart-legend">
            <div class="pl-legend-item body-xsmall">
              <div class="pl-legend-indicator bar"></div>
              <span>Estimated P(E)</span>
            </div>
            <div class="pl-legend-item body-xsmall">
              <div class="pl-legend-indicator dashed"></div>
              <span>Theoretical P(E)</span>
            </div>
          </div>
        </section>

        <section class="box card" id="pl-frequency-card">
          <div class="pl-chart-header">
            <h2 class="heading-xsmall">Frequency Table</h2>
            <p class="pl-chart-subtitle body-xsmall">Δ shows difference between observed and theoretical. Selected rows count toward Event E.</p>
          </div>
          <div class="pl-table-wrap">
            <table id="pl-frequency-table" class="pl-table body-small"></table>
          </div>
        </section>
      </div>

      <div id="pl-two-view" hidden>
        <div class="pl-content-grid">
          <section class="box card" id="pl-joint-distribution-card">
            <h2 class="heading-xsmall">Joint Distribution</h2>
            <canvas id="pl-heatmap" class="pl-canvas" aria-label="Heatmap of joint relative frequencies"></canvas>
            <div id="pl-cell-summary" class="pl-cell-summary body-small" aria-live="polite"></div>
          </section>

          <section class="box card" id="pl-two-way-table-card">
            <h2 class="heading-xsmall">Two-way Table</h2>
            <div class="pl-table-wrap">
              <table id="pl-twoway-table" class="pl-table body-small"></table>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <!-- Core Scripts -->
  <script type="module" src="./app.js"></script>
</body>
</html>
